function openAjax() {

var ajax;

try{
    ajax = new XMLHttpRequest(); // XMLHttpRequest para browsers decentes, como: Firefox, Safari, dentre outros.
}catch(ee){
    try{
        ajax = new ActiveXObject("Msxml2.XMLHTTP"); // Para o IE da MS
    }catch(e){
        try{
            ajax = new ActiveXObject("Microsoft.XMLHTTP"); // Para o IE da MS
        }catch(E){
            ajax = false;
        }
    }
}
return ajax;
}


/* FUNCOES SCALA PRANCHA */
function selecionarPranchasNaLista(idp, tipop){
	if (document.frm_abrir_prancha.id.value != "")
		document.getElementById("prancha_lista_pranchas"+document.frm_abrir_prancha.id.value).style.background = "#a0c544";   
	document.frm_abrir_prancha.id.value = idp; 
	document.frm_abrir_prancha.tipo.value = tipop;
	document.getElementById("prancha_lista_pranchas"+idp).style.background = "#ccc";
}

function tela_carregar_ajax(texto){
	$('#div-carregamento-pagina').show();
	document.getElementById('div-carregamento-pagina-content').innerHTML='<div style="background: #fff; padding: 10px; z-index: 9999999; top: 50%; margin-top: -100px; left: 50%; margin-left: -100px; width: 200px; position: absolute;" > '+texto+' <br/><img src="imagens/site/carregando.gif" width="200px" /></div>';
}

function fechar_tela_carregar_ajax(){
	$('#div-carregamento-pagina').hide();
}

function msgOver(texto, delay){
	$('#div-carregamento-pagina').show();
	document.getElementById('div-carregamento-pagina-content').innerHTML='<div style="background: #fff; padding: 10px; z-index: 9999999; margin: 0 auto; top: 200px; display: table; position: relative;" > '+texto+' </div>';
	setTimeout("$('#div-carregamento-pagina').fadeOut('fast')", delay*1000);
}


function pesquisa_lista_prancha(termo, tipo,  iddiv ){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById(iddiv); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "pesquisar_lista_pranchas.php?tipo=" + tipo + "&termo=" + termo, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}	

function verificarSeTemSom(){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('div_verificar_se_tem_som'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "verificar_se_tem_som.php?id_prancha=" + selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
						$('#dialog_upload_som').dialog('open');
					}
				}
			}
			ajax.send(null); // submete
	}
}

function apagarSom(id){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('div_verificar_se_tem_som'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "apagar_som.php?id=" + id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
						jAlert("Som Apagado, agora o som da imagem vai ser a sua legenda!","Alerta de som");
						$('#dialog_upload_som').dialog('close');
					}
				}
			}
			ajax.send(null); // submete
	}
}	

function apagar_minha_img(id){
	jConfirm('A imagem sera removida definitivamente, deseja continuar?', 'Aviso de Imagem', function(r){ 
		if (r){
			if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
					var ajax = openAjax(); // Inicia o Ajax.
					ajax.open("GET", "apagar_minha_imagem.php?id=" + id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
					ajax.onreadystatechange = function() {
						if(ajax.readyState == 4) { // Quando estiver tudo pronto.
							if(ajax.status == 200) {
								var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
								document.frm_esq_itens.tipo_lista_imagens.value = 1000;
								zerarSelecao();
								escolherCatImagens(8,0);
							}
						}
					}
					ajax.send(null); // submete
			}
		}
	});
}	

function buscarImgs(cat){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
			var ajax = openAjax(); // Inicia o Ajax.
			var exibeResultado = document.getElementById('listarImagens'); // div que exibirá o resultado da busca.
			ajax.open("GET", "desenha_lista_imagens.php?cat=" + cat, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}	
	
function escolherCatImagens(n, n2){
	if(document.frm_esq_itens.tipo_lista_imagens.value!=n){
		document.frm_esq_itens.tipo_lista_imagens.value = n;
		buscarImgs(n2);
	} 
	else { 
		document.frm_esq_itens.tipo_lista_imagens.value = '0'; 
		zerarSelecao(); 
		buscarImgs(1000); 
	}
}

function escolherCatImagensHist(n, n2){
	if(document.frm_esq_itens.tipo_lista_imagens.value!=n){
		document.frm_esq_itens.tipo_lista_imagens.value = n;
		buscarImgs(n2); 
	} 
	else { 
		document.frm_esq_itens.tipo_lista_imagens.value = '0'; 
		zerarSelecaoHist(); 
		buscarImgs(1000); 
	}
}

function mostrarListaTextos(n){
	if(document.frm_esq_itens.tipo_lista_imagens.value!=n){
		document.frm_esq_itens.tipo_lista_imagens.value = n;
		buscarTextos();
	} 
	else { 
		document.frm_esq_itens.tipo_lista_imagens.value = '0'; 
		zerarSelecaoHist(); 
		buscarImgs(1000); 
	}
}

function carregandoListaImagens(){
		document.getElementById('lista_imgs').innerHTML = '<div style="top: 50px; width: 24px; height: 24px; position: relative;" ><img src="imagens/site/carregando2.gif" width="24px" height="24px"  /></div>'; 
}

function exportarPDF(){
	tela_carregar_ajax("Aguarde. A Prancha esta sendo gerada...");
	setTimeout("fechar_tela_carregar_ajax()",10000);
	location.href = 'exportar_pdf.php';	
}

function apagar_prancha_lista(id){
	jConfirm('A prancha sera apagada definitivamente, deseja continuar?','Aviso de prancha', function(r){
		if (r){
			if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
					var ajax = openAjax(); // Inicia o Ajax.
					ajax.open("GET", "apagar_prancha_lista.php?id=" + id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
					ajax.onreadystatechange = function() {
						if(ajax.readyState == 4) { // Quando estiver tudo pronto.
							if(ajax.status == 200) {
								document.getElementById("prancha_lista_pranchas"+id).style.display = 'none';
								var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
							}
						}
					}
					ajax.send(null); // submete
			}
		}
	});
}

	

// Função que realiza consulta das imagens php e retorna texto no objeto passado (div)
function buscarImagens(categoria, id_div) {
	zerarSelecao();
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById(id_div); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "desenha_lista_imagens.php?cat=" + categoria, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}	// JavaScript Document

function buscarTextos() {
	zerarSelecao();
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('listarImagens'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "desenha_lista_textos.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}	// JavaScript Document

// Função que insere prancha sobre prancha 
function inserePranchaPrancha(pranchaorigem, pranchadestino, ocupada) {
	if (ocupada == 1) 
		jConfirm('o Conteudo desta prancha sera apagado, deseja continuar?','Aviso', function(r){ 
			if (r) inserePranchaPranchaAux(pranchaorigem, pranchadestino, ocupada);
		});	
	else
		inserePranchaPranchaAux(pranchaorigem, pranchadestino, ocupada);
}	// JavaScript Document

function inserePranchaPranchaAux(pranchaorigem, pranchadestino, ocupada) {
	zerarSelecao();
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
		var ajax = openAjax(); // Inicia o Ajax.
		ajax.open("GET", "insere_prancha_prancha.php?pranchaorigem=" + pranchaorigem + "&pranchadestino=" +pranchadestino, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
		ajax.onreadystatechange = function() {
			if(ajax.readyState == 4) { // Quando estiver tudo pronto.
				if(ajax.status == 200) {
					var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
					exibeResultado.innerHTML = resultado;
				}
			}
		}
		ajax.send(null); // submete
	}
}

function novoLayout(tipo) {
	if (selecaoGlobal.tipo == 2)
		zerarSelecao();
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "verificarnovolayout.php?tipo_novo_layout=" + tipo, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
						eval(resultado);
					}
				}
			}
			ajax.send(null); // submete
	}
}	// JavaScript Document

function mudarQuadro(direcao) {
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "mudar_de_quadro.php?direcao=" + direcao, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;

					}
				}
			}
			ajax.send(null); // submete
	}
}	// JavaScript Document

function selecionar(id, tipo){
	if ((selecaoGlobal.tipo == 1) && (selecaoGlobal.id == id)){
		zerarSelecao();
		return;
	}
	zerarSelecao();
	selecaoGlobal.id = id;
	selecaoGlobal.tipo = tipo;
	if (selecaoGlobal.tipo == 1){ //se for imagem
		document.getElementById("qdr_imagem_lista"+selecaoGlobal.id).style.background = '#eee';
		document.getElementById("qdr_imagem_lista"+selecaoGlobal.id).style.border = '1px dashed #fff';
	}
	else //se for prancha
		document.getElementById("prancha"+selecaoGlobal.id).style.background = '#eee';
	
}

function inserirNaPrancha(idImagem, prancha, ocupada){
	if (ocupada == 1) 
		jConfirm('o Conteudo desta prancha sera apagado, deseja continuar?','Aviso', function(r){ 
			if (r) inserirNaPranchaAux(idImagem, prancha, ocupada);
		});	
	else
		inserirNaPranchaAux(idImagem, prancha, ocupada);
}

function inserirNaPranchaAux(idImagem, prancha, ocupada){
	zerarSelecao(); //zera a seleção
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "inserir_imagem_prancha.php?id_imagem=" + idImagem + "&prancha=" +prancha, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}


function salvar_prancha(tipo, nome){
	tela_carregar_ajax('Sua prancha esta sendo salva. Aguarde...');
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "salvar_prancha.php?tipo=" + tipo + "&nome=" + nome, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						fechar_tela_carregar_ajax();
						msgOver("Prancha Salva!", 1);
					}
				}
			}
			ajax.send(null); // submete
	}	
}


function removerPrancha(){
	jConfirm('O conteudo desta prancha sera apagado, deseja continuar?','Aviso',function(r){
		if (r){
			if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
				var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
					var ajax = openAjax(); // Inicia o Ajax.
					ajax.open("GET", "remover_prancha.php?id=" + selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
					ajax.onreadystatechange = function() {
						if(ajax.readyState == 4) { // Quando estiver tudo pronto.
							if(ajax.status == 200) {
								var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
								exibeResultado.innerHTML = resultado;
							}
						}
					}
					ajax.send(null); // submete
			}
			zerarSelecao();
		}
	});
}

function sintetizarNomePrancha(){
	document.getElementById('sintetizador_de_som').innerHTML = '<iframe src="sintetizar_som_prancha.php?id='+selecaoGlobal.id+'" style="display:block; border:0; position: absolute;"></iframe>';
}

function repPrancha(n){
	document.getElementById('sintetizador_de_som').innerHTML = '<iframe src="sintetizar_som_prancha.php?id='+n+'" style="display:block; border:0; position: absolute;"></iframe>';
}

function sintetizarVisualizar(){
	document.getElementById('sintetizador_de_som').innerHTML = '<iframe src="reproduzir_visualizar.php"  style="display:block; border:0;  position: absolute;"></iframe>';
}

function salvar_arquivo(){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "criarArquivo.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						location.href = 'download.php?arquivo='+ resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}

	
function printDiv(id, pg) {
	var oPrint, oJan;
	oPrint = window.document.getElementById(id).innerHTML;
	oJan = window.open(pg);
	oJan.document.write("<html><head><link href='styles/geral.css' rel='stylesheet' type='text/css' /></head><body>");
	oJan.document.write(oPrint);		
	oJan.document.write("</body></html>");
	oJan.window.print();
	oJan.document.close();
	oJan.focus();
}

function montarVisualizacao(){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('dialog_visualizar'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "montar_visualizacao.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}

function montarListaDePranchas(){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('dialog_abrirArquivo'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "montarListaDePranchas.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}

function desfazer(){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "desfazer.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
	zerarSelecao();
}

function alterarLegenda(novalegenda){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			novalegenda = novalegenda.toUpperCase();
			ajax.open("GET", "alterarLegenda.php?idprancha="+ selecaoGlobal.id +"&novalegenda="+novalegenda, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
	zerarSelecao();
}

function zerarSelecao(){
	if (selecaoGlobal.id != -1000 )
		if (selecaoGlobal.tipo == 1){ //se for imagem
		  document.getElementById("qdr_imagem_lista"+selecaoGlobal.id).style.background = 'transparent'; // desselecionar a anterior
		  document.getElementById("qdr_imagem_lista"+selecaoGlobal.id).style.border = '1px dashed transparent';	
		}
		else{ //se for prancha
		  document.getElementById("prancha"+selecaoGlobal.id).style.background = '#ccc'; // desselecionar a anterior
		  fecharOpcoesPrancha();
		}
	selecaoGlobal.id = -1000;
	selecaoGlobal.tipo = 0;
}

function clickPrancha(idPrancha, ocupada){
	if (selecaoGlobal.id != -1000 && selecaoGlobal.tipo == 1){ 
		inserirNaPrancha(selecaoGlobal.id, idPrancha , ocupada);
	}
	else if (selecaoGlobal.id != -1000 && selecaoGlobal.tipo == 2 && selecaoGlobal.id != idPrancha) {
		inserePranchaPrancha(selecaoGlobal.id, idPrancha , ocupada); 
	}
	else if (selecaoGlobal.id == idPrancha && selecaoGlobal.tipo == 2){
		zerarSelecao();
	}
	else if (ocupada == 1){
		selecionar(idPrancha, 2);
		abrirOpcoesPrancha();
	}
}

function redimensionar(){
		location.href='index.php'; 
	}
	

function varGlobal(id, tipo) {
	this.id = id;
	this.tipo = tipo; // 1 -> imagem, 2 -> Prancha / imgusada(HISTORIA)
}	
	

/* FUNCOES SCALAHISTORIA */
function entrarQuadrinho(quadrinho){
	location.href="gerarCancelar.php?id="+quadrinho;
}

function novoLayoutHistoria(tipo) {
	if (selecaoGlobal.tipo == 2)
		zerarSelecao();
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "verificarnovolayout.php?tipo_novo_layout=" + tipo, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;

					}
				}
			}
			ajax.send(null); // submete
	}
}	// JavaScript Document

function insereImagemQuadrinho(X,Y) {
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "insere_imagem_quadrinho.php?left=" + (X-5) + "&top=" + (Y-5) + "&id=" + selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
	zerarSelecaoHist();
}	

function zerarSelecaoHist(){
	if (!permissao_para_selecionar) return;
	if (selecaoGlobal.id != -1000 )
		if (selecaoGlobal.tipo == 1){ //se for imagem
		  document.getElementById("qdr_imagem_lista"+selecaoGlobal.id).style.background = 'transparent'; // desselecionar a anterior
		  document.getElementById("qdr_imagem_lista"+selecaoGlobal.id).style.border = '1px dashed transparent';	
		}
		else if (selecaoGlobal.tipo == 2){ //se for imgQuad
		  document.getElementById("imgQuad"+selecaoGlobal.id).style.background = 'transparent'; // desselecionar a anterior
		  document.getElementById("imgQuad"+selecaoGlobal.id).style.border = '1px dashed transparent';
		  fecharOpcoesImgQuad();	 
		}
	selecaoGlobal.id = -1000;
	selecaoGlobal.tipo = 0;
}

function selecionarHist(id, tipo){
	if (!permissao_para_selecionar) return;
	if ((selecaoGlobal.tipo == 1) && (selecaoGlobal.id == id)){
		zerarSelecaoHist();
		return;
	}
	zerarSelecaoHist();
	selecaoGlobal.id = id;
	selecaoGlobal.tipo = tipo;
	if (selecaoGlobal.tipo == 1){ //se for imagem
		document.getElementById("qdr_imagem_lista"+selecaoGlobal.id).style.background = '#eee';
		document.getElementById("qdr_imagem_lista"+selecaoGlobal.id).style.border = '1px dashed #fff';
	}
	else if (selecaoGlobal.tipo == 2){ //se for imgQuad
		document.getElementById("imgQuad"+selecaoGlobal.id).style.background = '#eee';
		document.getElementById("imgQuad"+selecaoGlobal.id).style.border = '1px dashed #fff';
		abrirOpcoesImgQuad();
	}
}

function concluirQuadrinho(){
	location.href='index.php';
}

function limparQuadrinho() {
	permissao_para_selecionar = true;
	jConfirm("Tem certeza que deseja apagar permanentemente o conteudo deste quadrinho?","Aviso", function(r){
		if (r){
			zerarSelecaoHist();
			if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
				var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
					var ajax = openAjax(); // Inicia o Ajax.
					ajax.open("GET", "limpar_quadrinho.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
					ajax.onreadystatechange = function() {
						if(ajax.readyState == 4) { // Quando estiver tudo pronto.
							if(ajax.status == 200) {
								var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
								exibeResultado.innerHTML = resultado;
							}
						}
					}
					ajax.send(null); // submete
			}
		}
	});
}

function trocaLugarImagemQuadrinho(X,Y) {
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "troca_lugar_img_quadrinho.php?left="+X+"&top="+Y+"&id="+selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
	zerarSelecaoHist();
}

function salvar_hist(tipo, nome){
	tela_carregar_ajax('Sua Hist&oacute;ria esta sendo salva. Aguarde...');
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "salvar_hist.php?tipo=" + tipo + "&nome=" + nome, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						fechar_tela_carregar_ajax();
						msgOver("Hist&oacute;ria Salva!", 1);
					}
				}
			}
			ajax.send(null); // submete
	}	
}

function salvar_arquivo_hist(){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('centro'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "criarArquivo.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						location.href = 'download.php?arquivo='+ resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}

function montarListaDeHist(){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('dialog_abrirArquivo'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "montarListaDeHist.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}

function pesquisa_lista_hist(termo, tipo,  iddiv ){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById(iddiv); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "pesquisar_lista_hist.php?tipo=" + tipo + "&termo=" + termo, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}	

function selecionarHistNaLista(idp, tipop){
	if (document.frm_abrir_hist.id.value != "")
		document.getElementById("hist_lista_hist"+document.frm_abrir_hist.id.value).style.background = "#a0c544";   
	document.frm_abrir_hist.id.value = idp; 
	document.frm_abrir_hist.tipo.value = tipop;
	document.getElementById("hist_lista_hist"+idp).style.background = "#ccc";
}

function apagar_hist_lista(id){
	jConfirm('A historia sera apagada definitivamente, deseja continuar?','Aviso',function(r){
		if (r){
			if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
					var ajax = openAjax(); // Inicia o Ajax.
					ajax.open("GET", "apagar_hist_lista.php?id=" + id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
					ajax.onreadystatechange = function() {
						if(ajax.readyState == 4) { // Quando estiver tudo pronto.
							if(ajax.status == 200) {
								document.getElementById("hist_lista_hist"+id).style.display = 'none';
								var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
							}
						}
					}
					ajax.send(null); // submete
			}
		}
	});
}

function ampliarEReduzir(tam) {
	if (!permissao_para_selecionar) return;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "ampliarereduzir.php?tam="+tam+"&id="+selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
						var id = selecaoGlobal.id;
						zerarSelecaoHist();	
						selecionarHist(id, 2);
					}
				}
			}
			ajax.send(null); // submete
	}
}

function mudarAngulo(ang) {
	if (!permissao_para_selecionar) return;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "mudarangulo.php?ang="+ang+"&id="+selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
						var id = selecaoGlobal.id;
						zerarSelecaoHist();	
						selecionarHist(id, 2);
					}
				}
			}
			ajax.send(null); // submete
	}
}

function mudarProf(prof) {
	if (!permissao_para_selecionar) return;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "mudarprofundidade.php?prof="+prof+"&id="+selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						var res = resultado.split("quebrarParaAjustarQuadroSelecionado");
						if (typeof(res[1]) != 'undefined'){
							exibeResultado.innerHTML = res[1];
							zerarSelecaoHist();	
							selecionarHist(res[0], 2);
						}
						else{
							exibeResultado.innerHTML = resultado;
							var id = selecaoGlobal.id;
							zerarSelecaoHist();	
							selecionarHist(id, 2);
						}
					}
				}
			}
			ajax.send(null); // submete
	}
}

function mudarCorCenario(cor) {
	if (!permissao_para_selecionar) return;
	zerarSelecaoHist();	
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "mudar_cor_cenario.php?cor="+cor, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
	$('#dialog_escolher_cor_cenario').dialog('close');
	$('#dialog_cenario').dialog('close');
}

function mudarImagemCenario(urlimg) {
	if (!permissao_para_selecionar) return;
	zerarSelecaoHist();	
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "mudar_imagem_cenario.php?img="+urlimg, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
	$('#dialog_escolher_imagem_cenario').dialog('close');
	$('#dialog_cenario').dialog('close');
}

function inverter() {
	if (!permissao_para_selecionar) return;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "inverter.php?id="+selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
						var id = selecaoGlobal.id;
						zerarSelecaoHist();	
						selecionarHist(id, 2);
					}
				}
			}
			ajax.send(null); // submete
	}
}

function excluirImgQuad() {
	if (!permissao_para_selecionar) return;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "excluir_imgquad.php?id="+selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
	zerarSelecaoHist();					
}

function alterarNarracao(texto) {
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('narracao'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "alterar_narracao.php?texto="+texto, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}		
}

function clickImgQuad(idImgQuad){
	if ((selecaoGlobal.id == idImgQuad) && (selecaoGlobal.tipo == 2)) { 
		zerarSelecaoHist();
	}
	else if (selecaoGlobal.id == -1000){
		selecionarHist(idImgQuad, 2);
	}
	else
		selecaoGlobal.tipo = -selecaoGlobal.tipo; //controle para nao entrar na função de clique da tela ao mesmo tempo 
	selecaoGlobal.tipo = -selecaoGlobal.tipo; //controle para nao entrar na função de clique da tela ao mesmo tempo 
}

function cancelarQuadrinho(){
	location.href='cancelar.php';
}

function desfazerQuadrinho(){
	if (!permissao_para_selecionar) return;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "verificaDesfazer.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
	zerarSelecaoHist();
}

function sintetizarVisualizarHist(){
	document.getElementById('sintetizador_de_som').innerHTML = '<iframe src="reproduzir_visualizar.php"  style="display:block; border:0;  position: absolute;"></iframe>';
}

function alterarTextoBalao(novotexto) {
	permissao_para_selecionar = true;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('tela_quadrinho'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "alterar_texto_balao.php?id="+selecaoGlobal.id+"&texto="+novotexto, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
						var id = selecaoGlobal.id;
						zerarSelecaoHist();	
						selecionarHist(id, 2);
					}
				}
			}
			ajax.send(null); // submete
	}
}

function montarVisualizacaoHist(){
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('dialog_visualizar'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "montar_visualizacao.php", true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}

function montarAlterarTextoBalao() {
	permissao_para_selecionar = false;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('texto_balao'+selecaoGlobal.id); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "montar_alterar_texto_balao.php?id="+selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						exibeResultado.innerHTML = resultado;
					}
				}
			}
			ajax.send(null); // submete
	}
}

function sintetizarNarracao(){
	document.getElementById('sintetizador_de_som').innerHTML = '<iframe src="sintetizar_narracao.php" style="display:block; border:0; width:10px; height: 10px; position: absolute;"></iframe>';
}

function apagar_minha_img_hist(id){
	if (!permissao_para_selecionar) return;
	jConfirm('A imagem sera removida definitivamente, deseja continuar?','Aviso',function(r){
		if (r){
			if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
					var ajax = openAjax(); // Inicia o Ajax.
					ajax.open("GET", "apagar_minha_imagem.php?id=" + id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
					ajax.onreadystatechange = function() {
						if(ajax.readyState == 4) { // Quando estiver tudo pronto.
							if(ajax.status == 200) {
								var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
								document.frm_esq_itens.tipo_lista_imagens.value = 1000;
								zerarSelecaoHist();
								escolherCatImagensHist(8,0);
							}
						}
					}
					ajax.send(null); // submete
			}
		}
	});
}	

function abrirOpcoesImgQuad(){
		if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('dialog_opcoes_imgquad'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "montar_texto_img_quad.php?id="+selecaoGlobal.id, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
						if (resultado != '')
							eval(resultado);
					}
				}
			}
			ajax.send(null); // submete
		}
		document.getElementById("aumentaquad").style.display = "block";
		document.getElementById("diminuiquad").style.display = "block";
		document.getElementById("frentequad").style.display = "block";
		document.getElementById("atrasquad").style.display = "block";
		document.getElementById("girarquad").style.display = "block";
		document.getElementById("inverterquad").style.display = "block";
		document.getElementById("excluirquad").style.display = "block";
}
function fecharOpcoesImgQuad(){
		document.getElementById("textoquad").style.display = "none";
		document.getElementById("aumentaquad").style.display = "none";
		document.getElementById("diminuiquad").style.display = "none";
		document.getElementById("frentequad").style.display = "none";
		document.getElementById("atrasquad").style.display = "none";
		document.getElementById("girarquad").style.display = "none";
		document.getElementById("inverterquad").style.display = "none";
		document.getElementById("excluirquad").style.display = "none";
}

function exportarPDF_hist(){
	tela_carregar_ajax("Aguarde. A Hist&oacute;ria esta sendo gerada...");
	setTimeout("fechar_tela_carregar_ajax()",10000);
	location.href = 'criar_pasta_exportar.php';	
}


//####################Sistema de Varredura########################

//bloquear botão direito pra quando estiver fazendo a varredura e o usuário clicar não aparecer nada
function bloquear_botao_direito(){	
	var mensagem="";
	function clickIE() {if (document.all) {(mensagem);return false;}}
	function clickNS(e) {if 
	(document.layers||(document.getElementById&&!document.all)) {
	if (e.which==2||e.which==3) {(mensagem);return false;}}}
	if (document.layers) 
	{document.captureEvents(Event.MOUSEDOWN);document.onmousedown=clickNS;}
	else{document.onmouseup=clickNS;document.oncontextmenu=clickIE;}
	document.oncontextmenu=new Function("return false")
}

//Após o usuário clicar e selecionar o botão direito é reabilitado
function desbloquear_botao_direito(){	
	var mensagem="";
	function clickIE() {if (document.all) {(mensagem);return true;}}
	function clickNS(e) {if 
	(document.layers||(document.getElementById&&!document.all)) {
	if (e.which==2||e.which==3) {(mensagem);return true;}}}
	if (document.layers) 
	{document.captureEvents(Event.MOUSEDOWN);document.onmousedown=clickNS;}
	else{document.onmouseup=clickNS;document.oncontextmenu=clickIE;}
	document.oncontextmenu=new Function("return true")
}

/*Este ajax receb as informações das novas configurações do site
 * e atualiza SESSIONS através da página pgp atualizar_config_varredura 
 * Por enquanto esta função recebe apenas parâmetros de configurações de varredura,
 * mas deverá receber configurações do site. */
function novasConfigVarredura(estado,cor,velocidade){
	estadoVar = 0;
	if(document.getElementById) { // Para os browsers complacentes com o DOM W3C.
		var exibeResultado = document.getElementById('dialog_opcoes_imgquad'); // div que exibirá o resultado da busca.
			var ajax = openAjax(); // Inicia o Ajax.
			ajax.open("GET", "atualizar_config_varredura.php?estado="+estado+"&cor="+cor+"&velocidade="+velocidade, true); // Envia o termo da busca como uma querystring, nos possibilitando o filtro na busca.
			ajax.onreadystatechange = function() {
				if(ajax.readyState == 4) { // Quando estiver tudo pronto.
					if(ajax.status == 200) {
						var resultado = ajax.responseText; // Coloca o resultado (da busca) retornado pelo Ajax nessa variável (var resultado).
							eval(resultado);
					}
				}
			}
			ajax.send(null); // submete
	}

}


/* Área de váriaveis globais utilizadas, principalemente, da varredura do menu inferior e alguma em todas as varredura.
 * 
 * VetorVarreduraMenu       = Vetor com os ids dos ícones do menu inferior
 * VetorVarreduraLayout     = Vetor com os ids dos possiveis layouts do dialog
 * VetorVarreduraVisualizar = Vetor com os ids dos ícones da página visualizarImagensVarredura.php
 * estado_var               = 0 - varredura ativada; 1 - varredura desativada 
 * estadoVarCategorias      = 0 - varredura ativada; 1 - varredura desativada 
 * menu_atual				= guarda a posição do vetor que foi selecionada na varredura. Váriável usada em todos os vetores e varreduras.
 * varredura_atual			= Guarda qual lugar esta varrendo para saber qual vetor utilizar ou qual função chamar quando houver um click. 
 * 				1 - menu inferior;
 * 				2 - dialog layout
 * 				3 - varredura na página visualizar
 * 				4 - varredura nas categorias
 * 				5 - varredura complexa na seleção de imagens
 * 				6 - varredura simples na seleção de imagens
 * tempoVarredura			= guarda o tempo recebido na primeira função de varredura para não ter que passar como parâmetro por muito funções
 * 
 * São utilizadas mais de uma variável para guadar o estado na varredura por serem utilizadas mais de uma função para efetuar
 * a varredura de todos os elementos do sistema. Algumas varreduras não compartilham a mesma função por ficar muito complexo
 * o entendimento do código.
 */
var VetorVarreduraMenu = new Array ("abrir", "salvar", "desfaz", "importar","exportar","imprime","escolher_layout","visualizar","limpar","ajuda","sair","categorias");
var VetorVarreduraLayout = new Array ("layout_1","layout_2","layout_3","layout_4","layout_5");
var VetorVarreduraVisualizar= new Array ("seta_esq_visualizar", "seta_dir_visualizar", "voltar_visualizar", "reproduzir_visualizar");
var estadoVar = -1;
var estadoVarCategorias = -1;
var tempGlobal;
var menu_atual, tempoVarredura;
var varredura_atual = 1;
var tempoVarredura;

/* Função que é chamada na função IniciaVarredura e que tira o foco de um elemento. */
function DesfazerEfeitoVarredura(tempo,j){ 	
	var atual;
	if (varredura_atual == 1)
		atual = document.getElementById(VetorVarreduraMenu[j]);
	if (varredura_atual == 2) 
		atual = document.getElementById(VetorVarreduraLayout[j]);
	if (varredura_atual == 3) 
		atual = document.getElementById(VetorVarreduraVisualizar[j]);
	atual.style.border = "none";		
	setTimeout("IniciaVarredura("+tempo+","+j+")",50);
	return;
}

/* Função de varredura utilizada para varrer: Menu Inferior, Dialog com Layouts, Página visualizarImagensVarredura.php
 * Esta função recebe como parâmetro o tempo e um índice j que é utilizado para acessar um posição de determinado vetor. */
function IniciaVarredura(tempo, j){
	var atual, h = 0;

		if(j==-1)
			estadoVar=0;

		j++;
		
		/* Verificar qual a varredura_atual para zerar o j causando assim loop na varredura*/
		if (varredura_atual == 1)   //varrendo Menu Inferior
			if (j == 12) j = 0;
		if (varredura_atual == 2)	//Varrendo Dialog com Layouts
			if (j == 5) j = 0;
		if (varredura_atual == 3) 	//Varrendo Página visualizarImagensVarredura.php
			if (j == 4) j = 0;
		
		menu_atual = j;				//atualiza menu_atual para assim que for selecionada algum item saber
									//qual função saber
		tempoVarredura = tempo;		

		if (estadoVar == 1){
			desbloquear_botao_direito();
			return;
		}
	
		//bloqueia pra que quando o usuário clique com o botão direito para selecionar não apareçam as opções
		bloquear_botao_direito();
	
		if (varredura_atual == 1)
			atual = document.getElementById(VetorVarreduraMenu[j]);
		if (varredura_atual == 2)
			atual = document.getElementById(VetorVarreduraLayout[j]);
		if (varredura_atual == 3)
			atual = document.getElementById(VetorVarreduraVisualizar[j]);
		atual.style.border = "solid 2px #000";
		setTimeout("DesfazerEfeitoVarredura("+tempo+","+j+")",tempo);				
}

/* Função que desativa a varredura */
function DesativarVarredura(){
	var atual;
	
	document.getElementById("ItemMenuCategoria").style.display = "none";  //esconde o botão de avançar varredura
	atual = document.getElementById(VetorVarreduraMenu[menu_atual]);	
	atual.style.border = "none";
	estadoVar = 1;

	return;
}


/* Função que detecta clique do mouse
 * Verificar se o botão foi clicado e se o sistema esta com a varredura ativada. Estará ativada se:
 * 		estadoVar = 0, ou estavadoVarcategorias = 0, ou varredura_atual = 6
 * 
 * Esta função deve manter o ifs na ordem em que estão, caso contrário o sistemas pode não funcionar corretamente.
 * Exemplo: se a varredura_atual for 4, ao entrar na função escolherImagemVarredura(), a variável varredura_atual
 * 			receberá o valor 5 e ao retornar entrará no if (...=5).
 * 
 * A variável tempGlobal é apenas para controle, para que não entre na função antes que a varredura inicie corretamente.
 * Seu valor muda para 1 quando entra nas funções de tirar o foco de um item. 
 * 
 * Para saber o que é cada if, volte no código onde a variável varredura_atual foi criada.
 * */
function click(){ 
	if ((event.button==2 || event.button==3) && ((estadoVar == 0) || (estadoVarCategorias == 0) || (estadoVarreduraSimplesImgs == 0))){
		estadoVar=1;
		if ((varredura_atual == 7) && (tempGlobal == 1)){
			alert("oi");
			estadoVarreduraPrancha = 1;
		}
		if ((varredura_atual == 6) && (tempGlobal == 1)){
			estadoVarreduraSimplesImgs = 1;		
			selecionarEspacoNaPranchaAux();
			tempGlobal = 0;
		}
		if ((varredura_atual == 5) && (tempGlobal == 1)) {
			estadoVarCategorias = 1;
			tempGlogbal = 0;
			varreduraSelecaoImagens();			
		}
		if ((varredura_atual == 4) && (tempGlobal == 1)){
			estadoVarCategorias = 1;
			tempGlobal = 0;			
			escolherImagemVarredura();
		}
		if (varredura_atual == 1) chamarFuncaoMenuSelecionado(); 
		if (varredura_atual == 2) chamarFuncaoLayoutEscolhido();
		if (varredura_atual == 3) chamarFuncaoMenuVisualizar();		
	}
}
document.onmousedown=click;
window.captureEvents(Event.CLICK);
window.onmousedown=click;

/* Função que verifica qual o menu que estava em foco quando o usuário clicou e chama função correspondente 
 * A variável menu_atual assume os seguintes valores:
 * 0,1,3 = abrir, salvar, importar: ações não disponíveis
 * 2 = desfazer
 * 4 = exportar PDF
 * 5 = imprimir
 * 6 = escolher novo layout
 * 7 = visualizar prancha
 * 8 = limpar prancha
 * 9 = tutorial 
 * 10 = sair
 * 11 = avançar varredura para Categorias
 * */
function chamarFuncaoMenuSelecionado(){
	 //Funções do menu inferior disponíveis apenas no acesso direto
	if ((menu_atual == 0) || (menu_atual == 1) || (menu_atual == 3)){
		jAlert('Esta op&ccedil;&atilde;o est&aacute; dispon&iacute;vel apenas no acesso direto','Scalaweb');
		return;
	}
	if(menu_atual == 2){
		desfazer();
	}

	if(menu_atual==4){
		exportarPDF();	
	}

	if(menu_atual==5){ //antes de chamar a página dar um alert avisando que o sistema nao cobre a varredura da impressao 
		window.open('imprimir.php');	
	}

	if(menu_atual == 6){
		$('#dialog_escolher_layout').dialog('open');
		varredura_atual = 2;			
		atual = document.getElementById(VetorVarreduraMenu[menu_atual]);	
		atual.style.border = "none";
		estadoVar = 1;
		setTimeout("IniciaVarredura("+tempoVarredura+",-1)",300);	
	}
	if(menu_atual == 7){
		varredura_atual = 3;
		location.href="visualizar.php?tempoVarredura="+tempoVarredura;
	}
	if(menu_atual == 8){
		jConfirm('Tem certeza que deseja apagar todas as pranchas?','Aviso',function(r){ if(r){ novoLayout(0) }});
	}
	
	if(menu_atual==9){
		inTutorial();
	}
	if(menu_atual == 10){
		location.href = 'index.php?logout=1';
	}
	if(menu_atual == 11){
		atual = document.getElementById(VetorVarreduraMenu[menu_atual]);	
		atual.style.border = "none";
		estadoVar = 1;
		estadoVarCategorias = 0;
		varredura_atual = 4;
		tempGlobal = 0;
		varreduraImgsCatComplexaESimples(0,-1);
	}
	return;	
}

/*Função que é chamada quando o usuário clica e a varredura esta na página
 * visualizarImagensVarredura.php. Menu_atual assume os seguintes valores:
 * 0,1 = flecha para esquerda, direira
 * 2 = voltar
 * 3 = reproduzir
 * */
function chamarFuncaoMenuVisualizar(){
	//if (menu_atual == 0)
	//if (menu_atual == 1)
	if (menu_atual == 2)
		location.href = 'index.php';
	if (menu_atual == 3)
		sintetizarVisualizar();
	return;
}

/*Função que é chamada quando o usuário clica e a varredura estava no dialog de layouts. */
function chamarFuncaoLayoutEscolhido(){
	//Não está perguntando ao usuário ainda
	if (menu_atual == 0){
		novoLayout(1); $('#dialog_escolher_layout').dialog('close');
	}			
	if (menu_atual == 1){
		novoLayout(2); $('#dialog_escolher_layout').dialog('close');
	}
	if (menu_atual == 2){
		novoLayout(3); $('#dialog_escolher_layout').dialog('close');
	}
	if (menu_atual == 3){
		novoLayout(4); $('#dialog_escolher_layout').dialog('close');	
	}
	
	if (menu_atual == 4){
		novoLayout(5); $('#dialog_escolher_layout').dialog('close');
	}

	return;
}
/*>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>Varredura Categorias<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<*/
/* Variáveis utilizadas na varredura das categorias e em todo o processo de selecionar uma imagem e colocá-la na prancha.
 * VetorVarreduraCategorias    = vetor que tem os ids de casa imagem que representa uma categoria
 * VetorVarreduraImgsDivs      = vetor que tem os ids de 4 divs, estas divs são as utilizadasa na varredura complexa durante a seleção de imagens
 * VetorVarreduraImagens       = vetor que leva 32 itens que são os ids das imagens que estão na tela para varredura.
 * estadoVarreduraSimplesImgs  = variável que guarda o estado da varredura simples nas imagens: 0 - ativada, 1 - desativada
 */
var VetorVarreduraCategorias = new Array ("catPessoas","catObjetos","catNatureza","catAcoes","catAlimentos","catSentimentos","catQualidades","catMinhasI");
var VetorVarreduraImgsDivs = new Array ("divImg1","divImg9","divImg17","divImg25");
var VetorVarreduraImagens = new Array(32);
var VetorVarreduraPranchas = new Array("prancha0", "prancha1", "prancha2", "prancha3", "prancha4", "prancha5", "prancha6", "prancha7", "prancha8", "prancha9", "prancha10", "prancha11");
var estadoVarreduraSimplesImgs;
var estadoVarreduraPrancha;

/*	1 - menu inferior;
 * 	2 - dialog layout
 * 	3 - varredura na página visualizar
 *	4 - varredura nas categorias
 *	5 - varredura complexa na seleção de imagens
 *	6 - varredura simples na seleção de imagens */


/*Função que varre as categorias e 4 divs que separam as imagens em 4 linhas para ser feita a varredura complexa */
function varreduraImgsCatComplexaESimples(tempo, j){
	var h;
		j++;
			
		if (varredura_atual == 4) if (j == 8) j = 0;
		if (varredura_atual == 5){
			tempoVarredura = tempo;
			if (j == 4) j = 0;			
		}
		
		menu_atual = j;
		tempo = tempoVarredura;
		
		if (estadoVarCategorias == 1){
			desbloquear_botao_direito();
			return;
		}

		//bloqueia pra que quando o usuário clique para selecionar não apareçam as opções
		bloquear_botao_direito();
	
		if (varredura_atual == 4) atual = document.getElementById(VetorVarreduraCategorias[j]); 
		if (varredura_atual == 5) atual = document.getElementById(VetorVarreduraImgsDivs[j]);
		
		atual.style.border = "solid 2px #000";
		setTimeout("DesfazerEfeitoVarreduraImgsCatComplexaESimples("+tempo+","+j+")",tempo);		
			
}

//Função que auxilia na varredura - tira o foco de um item
function DesfazerEfeitoVarreduraImgsCatComplexaESimples(tempo,j){ 	
	tempGlobal = 1;
	var atual;
	if (varredura_atual == 4) atual = document.getElementById(VetorVarreduraCategorias[j]);
	if (varredura_atual == 5) atual = document.getElementById(VetorVarreduraImgsDivs[j]);
	atual.style.border = "none";		
	setTimeout("varreduraImgsCatComplexaESimples("+tempo+","+j+")",10);
	return;
}

/*Função chamada quando o usuário clica durante a varredura nas categorias.
 * Esta função chama a página que busca as 32 primeiras imagens do banco*/
function escolherImagemVarredura(){
	menu_atual++;
	if (menu_atual == 8) menu_atual = 0;
	location.href="visualizarImagensVarredura.php?categoria="+menu_atual+"&tempo="+tempoVarredura;
}

/*Função chamada quando o usuário clica e estava ativada a varredura nas quatro divs.
 * Nesta função é identificada qual a div clicada e chamada a função que varre as imagens que estão nela.*/
function varreduraSelecaoImagens(){
	estadoVarCategorias = 0;
	estadoVar = 0;
	estadoVarreduraSimplesImgs = 0;
	varredura_atual = 6;
	tempGlobal = 0;
		
	document.getElementById(VetorVarreduraImgsDivs[menu_atual]).style.border = "none";	
	
//o primeiro parâmetro é o número da div que será realizada a varredura simples
//e o segundo é qual a posição da primeira imagem dessa div no vetor
	if (menu_atual == 0)
		varreduraSimplesSelecionarImgs(1, -1);
	
	if (menu_atual == 1)
		varreduraSimplesSelecionarImgs(2, 7);
	
	if (menu_atual == 2)
		varreduraSimplesSelecionarImgs(3, 15);
			
	if (menu_atual == 3)
		varreduraSimplesSelecionarImgs(4, 23);
	
}

/*Função que varre cada imagem para que usuário selecione e ela seja colocada na prancha*/
function varreduraSimplesSelecionarImgs(divImg,j){	
	var tempo;
		j++;
		
		menu_atual = j;
		tempo = tempoVarredura;
		
			//identificar qual a div que esta varrendo, para reposicionar a varredura no inicio dela
			if (divImg == 1) if (j == 8) j = 0;
			if (divImg == 2) if (j == 16) j = 8;
			if (divImg == 3) if (j == 24) j = 16;
			if (divImg == 4) if (j == 32) j = 24;	
					
			
		if (estadoVarreduraSimplesImgs == 1){			
			desbloquear_botao_direito();
			return;
		}

		//bloqueia pra que quando o usuário clique para selecionar não apareçam as opções
		bloquear_botao_direito();
		
		atual = document.getElementById(VetorVarreduraImagens[j]);
		atual.style.border = "solid 2px #000";
		setTimeout("DesfazerEfeitoVarreduraSimplesImgs("+divImg+","+j+")",tempo);		

}

//Função auxiliar a varredura nas imagens - tira o foco da imagem e chama a função que coloca o foco na próxima
function DesfazerEfeitoVarreduraSimplesImgs(divImg,j){ 	
	tempGlobal = 1;	
	var atual;
	atual = document.getElementById(VetorVarreduraImagens[j]);
	atual.style.border = "none";
	setTimeout("varreduraSimplesSelecionarImgs("+divImg+","+j+")",300);
	return;
}

function selecionarEspacoNaPranchaAux(){
	estadoVarreduraSimplesImgs = 0;
	varredura_atual = 7;
	estadoVarreduraPrancha = 0;
	location.href="index.php?idImgVar="+VetorVarreduraImagens[menu_atual]+"&tempo="+tempoVarredura;
}

function SelecionaEspacoNaPrancha(jMax, j, tempo){
		j++;		
		menu_atual = j;		
		tempoVarredura = tempo;
		
		if (j == jMax) j = 0;
		
		if (estadoVarreduraPrancha == 1){			
			desbloquear_botao_direito();
			return;
		}

		//bloqueia pra que quando o usuário clique para selecionar não apareçam as opções
		bloquear_botao_direito();
		
		atual = document.getElementById(VetorVarreduraPranchas[j]);
		atual.style.border = "solid 2px #000";
		setTimeout("DesfazerSelecionaEspacoNaPrancha("+jMax+","+j+","+tempo+")",tempo);	
}

function DesfazerSelecionaEspacoNaPrancha(jMax,j,tempo){ 	
	tempGlobal = 1;	
	var atual;
	atual = document.getElementById(VetorVarreduraPranchas[j]);
	atual.style.border = "1px dashed #aaa;";
	setTimeout("SelecionaEspacoNaPrancha("+jMax+","+j+","+tempo+")",100);
	return;
}

function colocarImgSelecionadaNaPrancha(){
	
}
